/**
 * @name discordify
 * @author PINPAL#5245 and chazzox#1001
 * @description Spotify but inside discord
 * @version 0.0.1
 * @website https://github.com/chazzox/discordify#readme
 * @source https://github.com/chazzox/discordify
 */
const{React:e,ReactDOM:t}=BdApi;BdApi.injectCSS("discordify","./discordify.css");const o=BdApi.findModuleByProps("getActiveSocketAndDevice"),n=BdApi.findModuleByProps("SpotifyAPI");async function a(e){const t=await fetch(" https://api.spotify.com/v1/me/player/currently-playing",{headers:{Authorization:"Bearer "+e}});(await t.json()).is_playing?async function(e){fetch("https://api.spotify.com/v1/me/player/pause",{method:"PUT",headers:{Authorization:"Bearer "+e}})}(e):async function(e){fetch("https://api.spotify.com/v1/me/player/play",{method:"PUT",headers:{Authorization:"Bearer "+e}})}(e)}function i(){const[i,c]=e.useState(!0),[s,r]=e.useState(""),[l,d]=e.useState({}),[p,m]=e.useState([]),[u,y]=e.useState(!1);e.useEffect((()=>{const{socket:{accountId:e}}=o.getActiveSocketAndDevice();n.getAccessToken(e).then((e=>r(e.body.access_token)))}),[]);e.useEffect((()=>{if(s){(async function(e){const t=await fetch("https://api.spotify.com/v1/me",{headers:{Authorization:"Bearer "+e}});return await t.json()})(s).then((e=>d(e)));(async function(e){const t=[];let o="https://api.spotify.com/v1/me/playlists?limit=50";for(;o;){const n=await fetch(o,{method:"GET",headers:{Authorization:"Bearer "+e}}),a=await n.json();t.push(...a.items);o=a.next}return t})(s).then((e=>m(e)))}}),[s]);return e.createElement(e.Fragment,null,t.createPortal(e.createElement("button",{onClick:()=>c(!i)},"toggle"),document.getElementById("discordSpotifyToolbar")),!i&&e.createElement("div",null,l.display_name&&e.createElement("p",null,"Fuck off ",l.display_name),e.createElement("button",{onClick:()=>async function(e){fetch("https://api.spotify.com/v1/me/player/previous",{method:"POST",headers:{Authorization:"Bearer "+e}})}(s)},"backwards"),e.createElement("button",{onClick:()=>a(s)},"play/pause"),e.createElement("button",{onClick:()=>async function(e){fetch("https://api.spotify.com/v1/me/player/next",{method:"POST",headers:{Authorization:"Bearer "+e}})}(s)},"forwards"),e.createElement("button",{onClick:()=>y(!u)},"toggle playlists"),u&&e.createElement("div",{id:"playlistContainer",style:{width:"400px",overflowY:"scroll",userSelect:"text",height:"400px"}},p.map((t=>e.createElement("p",null,JSON.stringify(t)))))))}module.exports=class{load(){console.log("loading up")}start(){!function(){const e=document.createElement("div");e.id="discordSpotifyToolbar";document.getElementsByClassName("toolbar-1t6TWx")[0].append(e);const t=document.createElement("div");t.id="discordSpotifySidebar";document.getElementsByClassName("container-2lgZY8")[0].append(t)}();t.render(e.createElement(i,null),document.getElementById("discordSpotifySidebar"))}stop(){!function(){document.getElementById("discordSpotifySidebar")?.remove();document.getElementById("discordSpotifyToolbar")?.remove()}()}};